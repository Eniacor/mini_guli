<import src='../../components/goodDetail/classifyDialog.wxml' />
<import src='../../components/common/starList.wxml' />
<import src="../../common/component/wxParse/wxParse.wxml" />

<template is="classifyDialog" data='{{info,attr_arr,key_status,attr_str,buyNum,showDialog}}' />
<view wx:if="{{!loadEnd}}" class="loading"></view>
<view wx:else class="container">
    <swiper indicator-dots="true" autoplay="true" interval="5000" duration="500" style='height: 750rpx;width:750rpx;'>
        <block wx:for="{{info.images}}" wx:for-item='d' wx:for-index='i' wx:key='id'>
            <swiper-item>
                <image src="{{d.resource_name}}?imageView2/1/w/750/h/750/interlace/1" class="slide-image" />
            </swiper-item>
        </block>
    </swiper>
    <block wx:if="{{activity.activity_type==2}}">
        <view class="act_cont background_color_5hao">
            <text class="info">距离活动结束:</text>
            <block wx:if="{{end}}">
                <text class="act_end">
                    <text>秒杀结束</text>
                </text>
            </block>
            <block wx:else>
                <text class="act_time">
                    <text class="time">{{hrStr}}</text>
                    <text>:</text>
                    <text class="time">{{minStr}}</text>
                    <text>:</text>
                    <text class="time">{{secStr}}</text>
                </text>
            </block>
        </view>
    </block>

    <view class='base_info'>
        <view class='name'>
            <block wx:if="{{info.type==1}}">
                <text class="goods_type background_color_5hao">自营</text>
            </block>
            <block wx:if="{{info.type==2}}">
                <text>
                    <text class="goods_type background_color_5hao">积分</text>
                </text>
            </block>
            <text>{{info.name}}</text>
        </view>
        <view class='price_system flex align-c'>
            <view class="price color_5hao">￥{{info.price_system.price/100}}</view>
            <view class="crosse_price" wx:if="{{info.price_system.is_crossed == 1}}">￥{{info.price_system.crossed_price/100}}</view>
            <view wx:if="{{info.is_hot == 1}}" class='hot_tip background_color_5hao'>热销</view>
            <view wx:if="{{info.activity_id != 0}}" class='active_tip'>{{info.activity.name}}</view>
        </view>
        <view class='ship_price'>
            <block wx:if="{{info.delivery/100==0}}">
                免运费
            </block>
            <block wx:else>
                运费：￥{{info.delivery/100}}
            </block>
            <!-- <text wx:if='{{info.deliver_status == 2 || info.deliver_status == 3}}'> 满{{info.deliver[0] / 100}}元免运费</text> -->
        </view>
    </view>
    <view class="goods_info_sell">
        <view class="sell_item">
            <text class="name">销量：{{info.sales_number}}</text>
        </view>
        <view class="sell_item">
            <text class="name">评分：{{info.avg_score}}</text>
        </view>
        <view class="sell_item">
            <text class="name">好评率：{{info.praise}}%</text>
        </view>
    </view>
    <view hover='true' hover-class='hover1' class='select_area flex align-c' catchtap='onClickShow'>
        <view class='select_area_title'>已选</view>
        <view class='select_area_content flex_1'>
            <block wx:for='{{info.attr}}' wx:for-item='d' wx:for-index='i' wx:key='attr_value'>
                {{info.attr_info[d.attr_value]}}
                <block wx:if="{{ i != info.attr.length-1 }}">
                    -
                </block>
            </block>
            {{buyNum}} 件
        </view>
        <view class='select_area_jt iconfont icon-rightjt'></view>
    </view>
    <view class='good_info_bar flex'>
        <view class='good_info_bar_item flex-center align-c flex_1 {{barType==1?"border_color_5hao":""}}' data-type='1' bindtap='onChangeBar'>
            <view class='flex_1 flex-center word {{barType==1?"color_5hao":""}}'>商品详情</view>
        </view>
        <view class='good_info_bar_item flex-center align-c flex_1 {{barType==2?"border_color_5hao":""}}' data-type='2' bindtap='onChangeBar'>
            <view class='flex_1 flex-center word {{barType==2?"color_5hao":""}}'>评价</view>
        </view>
    </view>
    <view wx:if='{{barType==1}}' class='good_desc'>
        <template is="wxParse" data="{{wxParseData:desc.nodes}}" />
    </view>
    <view wx:elif='{{barType == 2}}' class='eval_list' style='margin-top: 5px;'>
        <block wx:if="{{ evalua_all_page == 0 }}">
            <view class='no_data eval_footer'>还没有评论哦~~</view>
        </block>
        <block wx:else>
            <view>
                <block wx:for="{{evalua_list}}" wx:for-item='d' wx:for-index='i' wx:key='id'>
                    <view class='eval_item'>
                        <view class='eval_item_inner flex'>
                            <view class='good_evaluation_item_cover_area'>
                                <image style="width:40px;height: 40px; border-radius: 40px" src="{{d.user.avatar}}"></image>
                            </view>
                            <view class='good_evaluation_item_info flex_1'>
                                <view class='flex align-c'>
                                    <view class='flex_1'>
                                        <view class='user_name'>{{d.user.nickname}}</view>
                                        <view class='star_outer'>
                                            <template is="startListEval" data="{{score:d.score}}" />
                                        </view>
                                    </view>
                                    <view class='flex_1'>
                                        <view class='evaluation_time'>{{d.create_time}}</view>
                                    </view>
                                </view>
                                <view class='evaluation_content'>
                                    {{d.content}}
                                </view>
                                <block wx:if="{{ d.images && d.images.length > 0 }}">
                                    <view class='evaluation_image flex'>
                                        <block wx:for='{{[1,2,3]}}' wx:for-item='dx' wx:for-index='i' wx:key='*this'>
                                            <view class='image_item flex_1'>
                                                <image wx:if='{{d.images[i]}}' style="width: 100%;height: 100%;" mode="aspectFill" src="{{d.images[i]}}?imageView2/1/w/90/h/60/interlace/1"></image>
                                            </view>
                                        </block>
                                    </view>
                                </block>
                            </view>
                        </view>
                    </view>
                </block>
            </view>

            <block wx:if="{{ evalua_all_page==1 }}">
                <view class='no_data eval_footer'>没有更多评论了~~</view>
            </block>
            <block wx:else>
                <navigator url='{{"/pages/evaluationList/evaluationList?id="+id}}' class='btn_more eval_footer'>查看更多评论</navigator>
            </block>
        </block>
    </view>
    <view class='good_detail_bar'>
        <view class='good_detail_bar_block'></view>
        <view class='good_detail_bar_fixed flex'>
            <view class="item to_customer">
                <button open-type="contact">
                    <text class="iconfont icon-customer"></text>
                </button>
            </view>
            <navigator url='/pages/cart/index' open-type='switchTab' class='item go_cart flex-center align-c'>
                <view class='iconfont icon-cart'></view>
                <view class='good_detail_cart_num background_color_5hao'>{{count>99?99:count}}</view>
            </navigator>
            <view hover='true' hover-class='hover1' class='item collection flex-center align-c flex_1' catchtap='onTapCollect'>
                <block wx:if="{{ is_collection }}">
                    <text class='iconfont icon-collectioned color_5hao'></text>
                </block>
                <block wx:else>
                    <text class='iconfont icon-collection'></text>
                </block>
            </view>
            <view class='item imm_buy flex-center align-c' catchtap='onTapImmBuy'>立即购买</view>
            <view hover='true' hover-class='hover1' class='item add_cart flex-center align-c background_color_5hao' catchtap='onTapAddcart'>加入购物车</view>
        </view>
    </view>
</view>